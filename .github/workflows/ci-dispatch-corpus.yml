# yaml
# File: '.github/workflows/ci.yml' in the student repo
name: CI

on:
  workflow_dispatch:
  push:
    branches: [ master ]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17
          cache: maven
      - run: mvn -B -q clean test

  submit-assignment:
    if: >
      success() &&
      (
        (github.event_name == 'push' && github.ref_name == 'master') ||
        (github.event_name == 'workflow_dispatch') ||
        (github.event_name == 'pull_request' && github.event.pull_request.head.repo.fork == false)
      )
    uses: mu-university/assignment-corpus/.github/workflows/submit.yml@v1
    secrets: inherit
    with:
      assignment: ${{ github.event.repository.name }}
      owner: ${{ github.repository_owner }}
      repo: ${{ github.repository }}
      ref: ${{ github.ref_name }}
